# Frida

<br />

## OWASP unCrackable level 1 Root detection bypass

in sg.vantagepoint.uncrackable1.MainActivity

```java
    protected void onCreate(Bundle bundle) {
        if (checkRoot.method1() || checkRoot.method2() || checkRoot.method3()) {
            a("Root detected!");
        }
        if (b.a(getApplicationContext())) {
            a("App is debuggable!");
        }
        super.onCreate(bundle);
        setContentView(R.layout.activity_main);
    }
```



in sg.vantagepoint.a.checkRoot

```java
public class checkRoot {
    /* renamed from: a */
    public static boolean method1() {
        for (String str : System.getenv("PATH").split(":")) {
            if (new File(str, "su").exists()) {
                return true;
            }
        }
        return false;
    }

    /* renamed from: b */
    public static boolean method2() {
        String str = Build.TAGS;
        return str != null && str.contains("test-keys");
    }

    /* renamed from: c */
    public static boolean method3() {
        for (String str : new String[]{"/system/app/Superuser.apk", "/system/xbin/daemonsu", "/system/etc/init.d/99SuperSUDaemon", "/system/bin/.ext/.su", "/system/etc/.has_su_daemon", "/system/etc/.installed_su_daemon", "/dev/com.koushikdutta.superuser.daemon/"}) {
            if (new File(str).exists()) {
                return true;
            }
        }
        return false;
    }
}
```

we want to hook on method 1, 2, 3 to make them return false.



application package: owasp.mstg.uncrackable1

function class: checkRoot

function name: method1, method2, method3

function argument: none

return type: boolean



in sg.vantagepoint.a.a

```java
public class a {
    public static byte[] a(byte[] bArr, byte[] bArr2) {
        SecretKeySpec secretKeySpec = new SecretKeySpec(bArr, "AES/ECB/PKCS7Padding");
        Cipher cipher = Cipher.getInstance("AES");
        cipher.init(2, secretKeySpec);
        return cipher.doFinal(bArr2);
    }
}
```





frida script to bypass root detection and get the secret key
hook.js

```java
Java.perform(function(){
    var my_cls = Java.use("sg.vantagepoint.a.checkRoot")
    my_cls.method1.implementation = function(){
		return false
    }
    my_cls.method2.implementation = function(){
    	return false
    }
    my_cls.method3.implementation = function(){
    	return false
    }
    
    
    var my_cls2 = Java.use("sg.vantagepoint.a.a")
    my_cls2.a.implementation = function(IV, Ct){
        var bArr = this.a(IV, Ct) 
        console.log("[+] bArr: " + bArr)
        let key = ""
        for(var i=0 ; i<bArr.length ; i++){
                key = key + String.fromCharCode(bArr[i])
        }

        console.log("[+] key: " + key)
        return bArr

    }

})
```



```
frida -U −l hook.js -f owasp.mstg.uncrackable1 --no-pause
```



also you can use **[frida code share](https://codeshare.frida.re/browse)**

```bash
└─$ frida -U --codeshare dzonerzy/fridantiroot  -f owasp.mstg.uncrackable1 
```



---

## bypass checkPin in allsafe.apk

in infosecadventures.allsafe.challenges.PinBypass

```java
package infosecadventures.allsafe.challenges;


public final class PinBypass extends Fragment {
    @Override // androidx.fragment.app.Fragment
    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
        Intrinsics.checkNotNullParameter(inflater, "inflater");
        View view = inflater.inflate(R.layout.fragment_pin_bypass, container, false);
        final EditText pin = (EditText) view.findViewById(R.id.pin);
        view.findViewById(R.id.check).setOnClickListener(new View.OnClickListener() { // from class: infosecadventures.allsafe.challenges.PinBypass$onCreateView$1
            @Override // android.view.View.OnClickListener
            public final void onClick(View it) {
                boolean checkPin;
                EditText pin2 = pin;
                Intrinsics.checkNotNullExpressionValue(pin2, "pin");
                if (!(pin2.getText().toString().length() == 0)) {
                    PinBypass pinBypass = PinBypass.this;
                    EditText pin3 = pin;
                    Intrinsics.checkNotNullExpressionValue(pin3, "pin");
                    checkPin = pinBypass.checkPin(pin3.getText().toString());
                    if (checkPin) {
                        SnackUtil snackUtil = SnackUtil.INSTANCE;
                        FragmentActivity requireActivity = PinBypass.this.requireActivity();
                        Intrinsics.checkNotNullExpressionValue(requireActivity, "requireActivity()");
                        snackUtil.simpleMessage(requireActivity, "Access granted, good job!");
                        return;
                    }
                }
                SnackUtil snackUtil2 = SnackUtil.INSTANCE;
                FragmentActivity requireActivity2 = PinBypass.this.requireActivity();
                Intrinsics.checkNotNullExpressionValue(requireActivity2, "requireActivity()");
                snackUtil2.simpleMessage(requireActivity2, "Incorrect PIN, try harder!");
            }
        });
        return view;
    }

    /* JADX INFO: Access modifiers changed from: private */
    public final boolean checkPin(String pin) {
        byte[] decode = Base64.decode("NDg2Mw==", 0);
        Intrinsics.checkNotNullExpressionValue(decode, "android.util.Base64.deco…roid.util.Base64.DEFAULT)");
        return Intrinsics.areEqual(pin, new String(decode, Charsets.UTF_8));
    }
}
```







### method 1: always return true

```java
Java.perform(function() {
var pinClass = Java.use('infosecadventures.allsafe.challenges.PinBypass')
pinClass.checkPin.implementation = function (pin) {
console.log("pin: " + pin)
return true;
}
})
```









### method 2: bruteforce

```java
Java.perform(function() {
var pinClass = Java.use('infosecadventures.allsafe.challenges.PinBypass')
pinClass.checkPin.implementation = function (pin) {

//4863

for (let i = 0; i < 9999; i++) {
    // Pad the number with leading zeros using string formatting
    const formattedNumber = i.toString().padStart(4, '0');
	var ret = this.checkPin(formattedNumber)
	//console.log("Pin test code is: " + formattedNumber + "    ret: "+ ret)
	if(ret){
		console.log("The correct  Pin code is: " + formattedNumber)
	}
	
	
  }
return ret
}
})
```



---



### Root detection bypass in allsafe.apk

in infosecadventures.allsafe.challenges.RootDetection

```java
package infosecadventures.allsafe.challenges;

public final void onClick(View it) {
                if (new RootBeer(RootDetection.this.getContext()).isRooted()) {
                    SnackUtil snackUtil = SnackUtil.INSTANCE;
                    FragmentActivity requireActivity = RootDetection.this.requireActivity();
                    Intrinsics.checkNotNullExpressionValue(requireActivity, "requireActivity()");
                    snackUtil.simpleMessage(requireActivity, "Sorry, your device is rooted!");
                    return;
                }
                SnackUtil snackUtil2 = SnackUtil.INSTANCE;
                FragmentActivity requireActivity2 = RootDetection.this.requireActivity();
                Intrinsics.checkNotNullExpressionValue(requireActivity2, "requireActivity()");
                snackUtil2.simpleMessage(requireActivity2, "Congrats, root is not detected!");
            }
```



in com.scottyab.rootbeer.RootBeer

```java
package com.scottyab.rootbeer;

public boolean isRooted() {
        return detectRootManagementApps() || detectPotentiallyDangerousApps() || checkForBinary(Const.BINARY_SU) || checkForDangerousProps() || checkForRWPaths() || detectTestKeys() || checkSuExists() || checkForRootNative() || checkForMagiskBinary();
    }

```



#### frida script

```java
Java.perform(function() {
var rootClass = Java.use('com.scottyab.rootbeer.RootBeer')
rootClass.isRooted.implementation = function (pin) {
console.log("root detection bypassed")
return false;
}
})

```

